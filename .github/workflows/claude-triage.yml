# Claude Ops: Triage new issues via PM role
# Triggers reactively when issues are opened.
# Cron fallback: daily 09:00 catches issues created without events (email/API).

name: "Claude: Triage New Issue"

on:
  issues:
    types: [opened]

concurrency:
  group: claude-pm-triage
  cancel-in-progress: false

permissions:
  contents: read
  issues: write

jobs:
  triage:
    runs-on: [self-hosted, claude-ops]
    timeout-minutes: 45
    env:
      CLAUDE_OPS_HOME: /Users/austin/Git_Repos/claude-ops
      HOME: /Users/austin
      PATH: /opt/homebrew/bin:/usr/local/bin:/usr/bin:/bin
    steps:
      - name: Run PM Triage
        run: "$CLAUDE_OPS_HOME/jobs/pm-triage.sh"
      - name: Notify on failure
        if: failure()
        env:
          WORKFLOW_NAME: ${{ github.workflow }}
        run: |
          echo "::error::Claude job failed: ${WORKFLOW_NAME} on $(date -u +%Y-%m-%dT%H:%M:%SZ)"
          echo "### Failed: PM Triage" >> "$GITHUB_STEP_SUMMARY"
          echo "Check workflow run logs for details." >> "$GITHUB_STEP_SUMMARY"
